var y=Object.prototype.toString;function v(e){return y.call(e)==="[object Array]"}function p(e){return y.call(e)==="[object Object]"}function V(e){return y.call(e)==="[object String]"}function w(e){return y.call(e)==="[object Number]"&&e===e}function A(e){return y.call(e)==="[object Boolean]"}function _(e){return y.call(e)==="[object Function]"}function S(e){return p(e)&&Object.keys(e).length===0}function b(e){return e==null||e===""}function x(e){return v(e)&&!e.length}var M=function(e,t){if(typeof e!="object"||typeof t!="object")return e===t;if(_(e)&&_(t))return e===t||e.toString()===t.toString();if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var r in e){var a=M(e[r],t[r]);if(!a)return!1}return!0},$=function(e,t){var r={};return Object.keys(e).forEach(function(a){var i=e[a],n=t&&t[a];r[a]=p(i)?Object.assign(Object.assign({},i),n):n||i}),r},P=function(e,t){for(var r=t.split("."),a=e,i=0;i<r.length;i++)if(a=a&&a[r[i]],a===void 0)return a;return a},g="#{field} is not a #{type} type",T={required:"#{field} is required",type:{ip:g,email:g,url:g,string:g,number:g,array:g,object:g,boolean:g},number:{min:"`#{value}` is not greater than `#{min}`",max:"`#{value}` is not less than `#{max}`",equal:"`#{value}` is not equal to `#{equal}`",range:"`#{value}` is not in range `#{min} ~ #{max}`",positive:"`#{value}` is not a positive number",negative:"`#{value}` is not a negative number"},string:{maxLength:"#{field} cannot be longer than #{maxLength} characters",minLength:"#{field} must be at least #{minLength} characters",length:"#{field} must be exactly #{length} characters",match:"`#{value}` does not match pattern #{pattern}",uppercase:"`#{value}` must be all uppercase",lowercase:"`#{value}` must be all lowercased"},array:{length:"#{field} must be exactly #{length} in length",minLength:"#{field} cannot be less than #{minLength} in length",maxLength:"#{field} cannot be greater than #{maxLength} in length",includes:"#{field} is not includes #{includes}",deepEqual:"#{field} is not deep equal with #{deepEqual}",empty:"#{field} is not an empty array"},object:{deepEqual:"#{field} is not deep equal to expected value",hasKeys:"#{field} does not contain required fields",empty:"`#{field} is not an empty object"},boolean:{true:"Expect true but got `#{value}`",false:"Expect false but got `#{value}`"}},h=function(t,r){var a=this;this.getValidateMsg=function(i,n){n===void 0&&(n={});var o=Object.assign(Object.assign({},n),{value:a.obj,field:a.field,type:a.type}),s=P(a.validateMessages,i);return _(s)?s(o):V(s)?s.replace(/\#\{.+?\}/g,function(d){var c=d.slice(2,-1);if(c in o){if(p(o[c])||v(o[c]))try{return JSON.stringify(o[c])}catch{return o[c]}return String(o[c])}return d}):s},p(r)&&V(t)&&r.trim?this.obj=t.trim():p(r)&&r.ignoreEmptyString&&t===""?this.obj=void 0:this.obj=t,this.message=r.message,this.type=r.type,this.error=null,this.field=r.field||r.type,this.validateMessages=$(T,r.validateMessages)},j={not:{configurable:!0},isRequired:{configurable:!0},end:{configurable:!0}};j.not.get=function(){return this._not=!this._not,this};j.isRequired.get=function(){if(b(this.obj)||x(this.obj)){var e=this.getValidateMsg("required");this.error={value:this.obj,type:this.type,requiredError:!0,message:this.message||(p(e)?e:(this._not?"[NOT MODE]:":"")+e)}}return this};j.end.get=function(){return this.error};h.prototype.addError=function(t){!this.error&&t&&(this.error={value:this.obj,type:this.type,message:this.message||(p(t)?t:(this._not?"[NOT MODE]:":"")+t)})};h.prototype.validate=function(t,r){var a=this._not?t:!t;return a&&this.addError(r),this};h.prototype.collect=function(t){t&&t(this.error)};Object.defineProperties(h.prototype,j);var z=function(e){function t(a,i){e.call(this,a,Object.assign(Object.assign({},i),{type:"string"})),this.validate(i&&i.strict?V(this.obj):!0,this.getValidateMsg("type.string"))}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={uppercase:{configurable:!0},lowercase:{configurable:!0}};return t.prototype.maxLength=function(i){return this.obj?this.validate(this.obj.length<=i,this.getValidateMsg("string.maxLength",{maxLength:i})):this},t.prototype.minLength=function(i){return this.obj?this.validate(this.obj.length>=i,this.getValidateMsg("string.minLength",{minLength:i})):this},t.prototype.length=function(i){return this.obj?this.validate(this.obj.length===i,this.getValidateMsg("string.length",{length:i})):this},t.prototype.match=function(i){var n=i instanceof RegExp;return n&&(i.lastIndex=0),this.validate(this.obj===void 0||n&&i.test(this.obj),this.getValidateMsg("string.match",{pattern:i}))},r.uppercase.get=function(){return this.obj?this.validate(this.obj.toUpperCase()===this.obj,this.getValidateMsg("string.uppercase")):this},r.lowercase.get=function(){return this.obj?this.validate(this.obj.toLowerCase()===this.obj,this.getValidateMsg("string.lowercase")):this},Object.defineProperties(t.prototype,r),t}(h),N=function(e){function t(a,i){e.call(this,a,Object.assign(Object.assign({},i),{type:"number"})),this.validate(i&&i.strict?w(this.obj):!0,this.getValidateMsg("type.number"))}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={positive:{configurable:!0},negative:{configurable:!0}};return t.prototype.min=function(i){return b(this.obj)?this:this.validate(this.obj>=i,this.getValidateMsg("number.min",{min:i}))},t.prototype.max=function(i){return b(this.obj)?this:this.validate(this.obj<=i,this.getValidateMsg("number.max",{max:i}))},t.prototype.equal=function(i){return b(this.obj)?this:this.validate(this.obj===i,this.getValidateMsg("number.equal",{equal:i}))},t.prototype.range=function(i,n){return b(this.obj)?this:this.validate(this.obj>=i&&this.obj<=n,this.getValidateMsg("number.range",{min:i,max:n}))},r.positive.get=function(){return b(this.obj)?this:this.validate(this.obj>0,this.getValidateMsg("number.positive"))},r.negative.get=function(){return b(this.obj)?this:this.validate(this.obj<0,this.getValidateMsg("number.negative"))},Object.defineProperties(t.prototype,r),t}(h),R=function(e){function t(a,i){e.call(this,a,Object.assign(Object.assign({},i),{type:"array"})),this.validate(i&&i.strict?v(this.obj):!0,this.getValidateMsg("type.array",{value:this.obj,type:this.type}))}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={empty:{configurable:!0}};return t.prototype.length=function(i){return this.obj?this.validate(this.obj.length===i,this.getValidateMsg("array.length",{value:this.obj,length:i})):this},t.prototype.minLength=function(i){return this.obj?this.validate(this.obj.length>=i,this.getValidateMsg("array.minLength",{value:this.obj,minLength:i})):this},t.prototype.maxLength=function(i){return this.obj?this.validate(this.obj.length<=i,this.getValidateMsg("array.maxLength",{value:this.obj,maxLength:i})):this},t.prototype.includes=function(i){var n=this;return this.obj?this.validate(i.every(function(o){return n.obj.indexOf(o)!==-1}),this.getValidateMsg("array.includes",{value:this.obj,includes:i})):this},t.prototype.deepEqual=function(i){return this.obj?this.validate(M(this.obj,i),this.getValidateMsg("array.deepEqual",{value:this.obj,deepEqual:i})):this},r.empty.get=function(){return this.validate(x(this.obj),this.getValidateMsg("array.empty",{value:this.obj}))},Object.defineProperties(t.prototype,r),t}(h),C=function(e){function t(a,i){e.call(this,a,Object.assign(Object.assign({},i),{type:"object"})),this.validate(i&&i.strict?p(this.obj):!0,this.getValidateMsg("type.object"))}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={empty:{configurable:!0}};return t.prototype.deepEqual=function(i){return this.obj?this.validate(M(this.obj,i),this.getValidateMsg("object.deepEqual",{deepEqual:i})):this},t.prototype.hasKeys=function(i){var n=this;return this.obj?this.validate(i.every(function(o){return n.obj[o]}),this.getValidateMsg("object.hasKeys",{keys:i})):this},r.empty.get=function(){return this.validate(S(this.obj),this.getValidateMsg("object.empty"))},Object.defineProperties(t.prototype,r),t}(h),K=function(e){function t(a,i){e.call(this,a,Object.assign(Object.assign({},i),{type:"boolean"})),this.validate(i&&i.strict?A(this.obj):!0,this.getValidateMsg("type.boolean"))}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={true:{configurable:!0},false:{configurable:!0}};return r.true.get=function(){return this.validate(this.obj===!0,this.getValidateMsg("boolean.true"))},r.false.get=function(){return this.validate(this.obj===!1,this.getValidateMsg("boolean.false"))},Object.defineProperties(t.prototype,r),t}(h),D=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,F=new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$","i"),I=/^(2(5[0-5]{1}|[0-4]\d{1})|[0-1]?\d{1,2})(\.(2(5[0-5]{1}|[0-4]\d{1})|[0-1]?\d{1,2})){3}$/,U=function(e){function t(a,i){e.call(this,a,Object.assign(Object.assign({},i),{type:"type"}))}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={email:{configurable:!0},url:{configurable:!0},ip:{configurable:!0}};return r.email.get=function(){return this.type="email",this.validate(this.obj===void 0||D.test(this.obj),this.getValidateMsg("type.email"))},r.url.get=function(){return this.type="url",this.validate(this.obj===void 0||F.test(this.obj),this.getValidateMsg("type.url"))},r.ip.get=function(){return this.type="ip",this.validate(this.obj===void 0||I.test(this.obj),this.getValidateMsg("type.ip"))},Object.defineProperties(t.prototype,r),t}(h),Z=function(e){function t(a,i){e.call(this,a,Object.assign(Object.assign({},i),{type:"custom"}))}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={validate:{configurable:!0}};return r.validate.get=function(){var a=this;return function(i,n){var o;if(i)return o=i(a.obj,a.addError.bind(a)),o&&o.then?(n&&o.then(function(){n&&n(a.error)},function(s){console.error(s)}),[o,a]):(n&&n(a.error),a.error)}},Object.defineProperties(t.prototype,r),t}(h),J=function(t,r){this.string=new z(t,r),this.number=new N(t,r),this.array=new R(t,r),this.object=new C(t,r),this.boolean=new K(t,r),this.type=new U(t,r),this.custom=new Z(t,r)},Y=function(t,r){r===void 0&&(r={}),this.schema=t,this.options=r};Y.prototype.validate=function(t,r){var a=this;if(!p(t))return;var i=[],n=null;function o(s,d){n||(n={}),(!n[s]||d.requiredError)&&(n[s]=d)}this.schema&&Object.keys(this.schema).forEach(function(s){if(v(a.schema[s]))for(var d=function(q){var f=a.schema[s][q],m=f.type,L=f.message;if(!m&&!f.validator)throw"You must specify a type to field "+s+"!";var O=new J(t[s],Object.assign(Object.assign({},a.options),{message:L,field:s})),u=O.type[m]||null;if(!u)if(f.validator){u=O.custom.validate(f.validator),Object.prototype.toString.call(u)==="[object Array]"&&u[0].then?i.push({function:u[0],_this:u[1],key:s}):u&&o(s,u);return}else u=O[m];if(Object.keys(f).forEach(function(l){f.required&&(u=u.isRequired),l!=="message"&&u[l]&&f[l]&&typeof u[l]=="object"&&(u=u[l]),u[l]&&f[l]!==void 0&&typeof u[l]=="function"&&(u=u[l](f[l]))}),u.collect(function(l){l&&o(s,l)}),n)return"break"},c=0;c<a.schema[s].length;c++){var E=d(c);if(E==="break")break}}),i.length>0?Promise.all(i.map(function(s){return s.function})).then(function(){i.forEach(function(s){s._this.error&&o(s.key,s._this.error)}),r&&r(n)}):r&&r(n)};export{Y as S};
