import{S as j}from"./axios-f944d4af.js";import{g as R,d as H,a as ee}from"./request-303e577c.js";import{u as te}from"./vue-router-1948c3ab.js";import{ah as ae,a2 as re,ac as oe,O as le,a6 as ne,e as w,ae as se,af as ie}from"./@ant-design-9faab50f.js";import{d as ue,r as d,f as pe,t as me,a0 as A,c as e,u as r,X as a,F as de,_ as ce,Y as s,Z as y,I as h,$ as ge,a4 as D,W as fe}from"./@vue-ed0e62b5.js";import{m as c}from"./ant-design-vue-8622cfc4.js";import"./axios-4a70c6fc.js";import"./@ctrl-fb5a5473.js";import"./@babel-9393a256.js";import"./resize-observer-polyfill-3d106987.js";import"./@emotion-c0b5c018.js";import"./stylis-af24efd6.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./vue-types-ef06c517.js";import"./dom-align-529d0cdc.js";import"./lodash-es-46efcfe4.js";import"./dayjs-bea8cda3.js";import"./async-validator-dee29e8b.js";import"./throttle-debounce-87e7e444.js";const _e=(i,u)=>R({url:"api/v1/users",params:{page_size:u.value.pageSize,page_num:u.value.pageNum,username:u.value.username},...i}),ve=i=>H({url:"api/v1/user/"+i}),xe=i=>R({url:"api/v1/user/"+i}),ye=(i,u)=>ee({url:"api/v1/user/"+u,data:i}),O={userListApi:_e,deleteUserApi:ve,getUserApi:xe,editUserApi:ye},he=ce("br",null,null,-1),Ue={key:0},be={key:0},Ge=ue({__name:"CA_UserList",setup(i){const u=d(),z=te(),U=d([]),T=[{title:"ID",dataIndex:"ID",key:"ID",width:"10%"},{title:"用户名",dataIndex:"username",width:"20%",align:"center"},{title:"角色",dataIndex:"role",width:"20%",align:"center"},{title:"操作",dataIndex:"action",width:"30%",align:"center"}],N=d({pageSizeOptions:["10","50","100"],total:0,showSizeChanger:!0,hideOnSinglePage:!1,showQuickJumper:!1}),m=d({username:"",pageSize:10,pageNum:1}),g=()=>{O.userListApi(U,m).then(o=>{if(o.data.status!==200)return c.error("数据获取异常",10);U.value=o.data.data,N.value.total=o.data.total})},L=async o=>{let t;if(o!=1)t=await j.delete("api/v1/user/"+o);else return t=500,c.error("禁止删除超级用户！",10);return t.status!==200?c.error("删除数据异常！",10):new Promise(_=>{setTimeout(()=>_(!0),3e3)}).then(()=>{g(),c.success("成功删除用户！",5)})},P=[{value:1,label:"管理员"},{value:2,label:"订阅者"}];let l=pe({id:"",username:"",email:"",avaterurl:"",role:[]});const B={username:[{required:!0,message:"Please input Activity Username",trigger:"change"},{min:3,max:15,message:"Length should be 3 to 15",trigger:"blur"}],email:[{required:!0,message:"Please input Email",trigger:"change"},{type:"email",message:"Type email",trigger:"blur"}],avaterurl:[{required:!0,message:"Please input AvaterUrl",trigger:"change"},{type:"url",message:"Type url",trigger:"blur"}],role:[{required:!0,message:"Please input",trigger:"change"}]},f=d(!1),b=d(!1),V=o=>{f.value=!0,O.getUserApi(o).then(t=>{l.id=t.data.data[0].ID,l.username=t.data.data[0].username,l.email=t.data.data[0].email,l.avaterurl=t.data.data[0].avaterurl,l.role=t.data.data[0].role})},$=o=>{b.value=!0,O.editUserApi(l,o).then(t=>{t.data.status==200?(c.success("成功修改用户信息！",5),console.log(l),console.log(t.data)):c.warn(t.data.message,5),g()}).then(t=>{setTimeout(()=>{f.value=!1,b.value=!1},1e3)})},E=()=>{z.push("UserAdd")},q=()=>{},F=(o,t,_)=>{const p={...o};p.current=o.current,p.pageSize=o.pageSize,m.value.pageSize=o.pageSize,m.value.pageNum=o.current,p.pageSize!==o.pageSize&&(m.value.pageNum=1,p.current=1),o=p,g()};return g(),me(l),(o,t)=>{const _=s("a-page-header"),p=s("a-input-search"),C=s("a-col"),v=s("a-button"),G=s("a-row"),M=s("a-popconfirm"),J=s("a-space"),K=s("a-table"),I=s("a-tooltip"),k=s("a-input"),x=s("a-form-item"),Q=s("a-select"),W=s("a-form"),X=s("a-modal");return y(),A(de,null,[e(_,{style:{border:"1px solid rgb(235, 237, 240)"},title:"用户列表",onBack:t[0]||(t[0]=()=>r(z).push("Index"))}),he,e(G,null,{default:a(()=>[e(C,{lg:6,md:6,sm:16,xl:6,xs:16},{default:a(()=>[e(p,{value:m.value.username,"onUpdate:value":t[1]||(t[1]=n=>m.value.username=n),allowClear:"","enter-button":"",placeholder:"input search text",onSearch:g},null,8,["value"])]),_:1}),e(C,{lg:6,md:6,sm:6,xl:6,xs:6},{default:a(()=>[e(v,{style:{"margin-left":"10px"},type:"primary",onClick:E},{icon:a(()=>[e(r(ae))]),default:a(()=>[h(" 新增用户 ")]),_:1}),e(v,{style:{"margin-left":"10px"},type:"primary",onClick:E},{icon:a(()=>[e(r(re))]),default:a(()=>[h(" 重置ID计数 ")]),_:1}),e(C,{lg:8,md:6,sm:4,xl:10,xs:2})]),_:1})]),_:1}),e(K,{bordered:!0,columns:T,"data-source":U.value,pagination:N.value,"row-key":n=>n.ID,style:{margin:"15px"},onChange:F},{bodyCell:a(({column:n,text:Y,record:S})=>[n.dataIndex==="role"?(y(),A("span",Ue,ge(Y===1?"管理员":"订阅者"),1)):D("",!0),n.dataIndex==="action"?(y(),fe(J,{key:1,size:8},{default:a(()=>[e(v,{type:"primary",onClick:Z=>V(S.ID)},{icon:a(()=>[e(r(oe))]),default:a(()=>[h(" Edit ")]),_:2},1032,["onClick"]),S.ID!=1?(y(),A("div",be,[e(M,{title:"是否删除这个用户",onCancel:q,onConfirm:Z=>L(S.ID)},{default:a(()=>[e(v,{danger:"",type:"primary"},{icon:a(()=>[e(r(le))]),default:a(()=>[h(" Delete ")]),_:1})]),_:2},1032,["onConfirm"])])):D("",!0)]),_:2},1024)):D("",!0)]),_:1},8,["data-source","pagination","row-key"]),e(X,{open:f.value,"onUpdate:open":t[6]||(t[6]=n=>f.value=n),"confirm-loading":b.value,title:"编辑用户信息",onOk:t[7]||(t[7]=n=>$(r(l).id))},{default:a(()=>[e(W,{ref_key:"formRef",ref:u,model:r(l),rules:B},{default:a(()=>[e(x,{name:"username"},{default:a(()=>[e(k,{value:r(l).username,"onUpdate:value":t[2]||(t[2]=n=>r(l).username=n),placeholder:"用户名"},{prefix:a(()=>[e(r(ne))]),suffix:a(()=>[e(I,{title:"输入用户名"},{default:a(()=>[e(r(w),{style:{color:"rgba(0, 0, 0, 0.45)"}})]),_:1})]),_:1},8,["value"])]),_:1}),e(x,{name:"email",style:{"margin-top":"10px"}},{default:a(()=>[e(k,{value:r(l).email,"onUpdate:value":t[3]||(t[3]=n=>r(l).email=n),placeholder:"电子邮箱",style:{"margin-top":"10px"}},{prefix:a(()=>[e(r(se))]),suffix:a(()=>[e(I,{title:"输入电子邮箱"},{default:a(()=>[e(r(w),{style:{color:"rgba(0, 0, 0, 0.45)"}})]),_:1})]),_:1},8,["value"])]),_:1}),e(x,{name:"avaterurl",style:{"margin-top":"10px"}},{default:a(()=>[e(k,{value:r(l).avaterurl,"onUpdate:value":t[4]||(t[4]=n=>r(l).avaterurl=n),placeholder:"头像外链",style:{"margin-top":"10px"}},{prefix:a(()=>[e(r(ie))]),suffix:a(()=>[e(I,{title:"输入头像外链"},{default:a(()=>[e(r(w),{style:{color:"rgba(0, 0, 0, 0.45)"}})]),_:1})]),_:1},8,["value"])]),_:1}),e(x,{name:"role",style:{"margin-top":"10px"}},{default:a(()=>[e(Q,{value:r(l).role,"onUpdate:value":t[5]||(t[5]=n=>r(l).role=n),options:P,placeholder:"用户权限"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])],64)}}});export{Ge as default};
