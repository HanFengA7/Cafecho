import{r as c}from"./index-b996fa11.js";import{S as m}from"./axios-602dd91c.js";import{_ as V}from"./index.vue_vue_type_script_setup_true_lang-b3a75293.js";import{d as G,r as x,f as b,w as L,t as W,a0 as k,c as o,u as g,X as l,F as C,_ as $,Y as i,Z as f,v as O,a1 as X,I as F,W as Y,$ as Z}from"./@vue-f4549c4f.js";import{n as _}from"./ant-design-vue-bdf622a3.js";import"./pinia-6e7a6e83.js";import"./vue-router-7a2dbc5b.js";import"./@ant-design-79c5b16b.js";import"./@ctrl-fb5a5473.js";import"./@babel-9393a256.js";import"./resize-observer-polyfill-3d106987.js";import"./@emotion-c0b5c018.js";import"./stylis-af24efd6.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./vue-types-ef06c517.js";import"./dom-align-529d0cdc.js";import"./lodash-es-46efcfe4.js";import"./dayjs-bea8cda3.js";import"./async-validator-dee29e8b.js";import"./throttle-debounce-87e7e444.js";import"./axios-4a70c6fc.js";import"./@tinymce-00f36401.js";import"./tinymce-6ac3427d.js";const j=$("br",null,null,-1),yt=G({__name:"CA_EditArticle",setup(z){const v=c.currentRoute.value.params.aid;let u;m.get("api/v1/AuthTokenInfo/"+window.sessionStorage.getItem("token")).then(a=>{u=a.data.UserInfo[0].ID});const R=x(),e=b({uid:u,title:"",desc:"",tags:"undefined",cid:void 0,img:"",content:""});m.get("api/v1/article/"+v).then(a=>{e.title=a.data.data.title,e.desc=a.data.data.desc,e.cid=a.data.data.cid,e.img=a.data.data.img,e.content=a.data.data.content,s.value=a.data.data.tags.split(",")});let s=x([]);const y=b({list:[{id:null,name:"不使用分类"}]}),S=()=>{m.get("api/v1/category",{params:{page_num:1}}).then(a=>{if(a.data.total!=0){let t=[];for(let d=0;d<a.data.total;d++)t.push({id:a.data.data[d].id,name:a.data.data[d].name});y.list=t}})},U={title:[{required:!0,message:"请输入文章标题",trigger:"change"}],desc:[{required:!0,message:"请输入文章概要",trigger:"change"}],content:[{required:!0,message:"请输入文章内容",trigger:"change"}]},A=a=>{e.content=a,console.log(a)},B=a=>{e.uid=u,e.tags=s.value.toString(),m.put("api/v1/article/"+a,e).then(t=>{t.data.status!=200?_.error({message:"Error",description:t.data.message}):(_.success({message:"Success",description:"文章修改成功"}),console.log(t.data),console.log(s.value))})},I=()=>{_.warn({message:"Warn",description:"请勿提交非法数据！"}),console.log(e.content)};return L(()=>c.currentRoute.value,a=>{console.log(a)},{immediate:!0}),S(),W(e),(a,t)=>{const d=i("a-page-header"),h=i("a-input"),r=i("a-form-item"),D=i("a-textarea"),w=i("a-col"),p=i("a-select"),q=i("a-row"),E=i("a-button"),N=i("a-form"),T=i("a-card");return f(),k(C,null,[o(d,{style:{border:"1px solid rgb(235, 237, 240)"},title:"编辑文章",onBack:t[0]||(t[0]=()=>g(c).push("../ArticleList"))}),j,o(T,null,{default:l(()=>[o(N,{ref_key:"formRef",ref:R,model:e,rules:U,name:"ArticleAddForm",onFinish:t[7]||(t[7]=n=>B(g(v))),onFinishFailed:I},{default:l(()=>[o(q,null,{default:l(()=>[o(w,{span:12},{default:l(()=>[o(r,{label:"文章标题",name:"title",style:{width:"550px"}},{default:l(()=>[o(h,{value:e.title,"onUpdate:value":t[1]||(t[1]=n=>e.title=n)},null,8,["value"])]),_:1}),o(r,{label:"文章概要",name:"desc",style:{width:"550px"}},{default:l(()=>[o(D,{value:e.desc,"onUpdate:value":t[2]||(t[2]=n=>e.desc=n),style:{height:"85px"}},null,8,["value"])]),_:1})]),_:1}),o(w,{span:12},{default:l(()=>[o(r,{label:"文章标签",name:"tags",style:{width:"550px"}},{default:l(()=>[o(p,{value:g(s),"onUpdate:value":t[3]||(t[3]=n=>O(s)?s.value=n:s=n),"token-separators":[","],mode:"tags",placeholder:"填写一些文章的标签",style:{width:"100%"}},null,8,["value"])]),_:1}),o(r,{label:"文章分类",name:"cid",style:{width:"550px"}},{default:l(()=>[o(p,{value:e.cid,"onUpdate:value":t[4]||(t[4]=n=>e.cid=n),name:"cid",placeholder:"文章分类"},{default:l(()=>[(f(!0),k(C,null,X(y.list,n=>(f(),Y(p,{key:"item.id",value:n.id},{default:l(()=>[F(Z(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),o(r,{label:"文章展图",name:"img",style:{width:"550px"}},{default:l(()=>[o(h,{value:e.img,"onUpdate:value":t[5]||(t[5]=n=>e.img=n)},null,8,["value"])]),_:1})]),_:1})]),_:1}),o(r,{name:"content"},{default:l(()=>[o(V,{value:e.content,"onUpdate:value":t[6]||(t[6]=n=>e.content=n),onGetContent:A},null,8,["value"])]),_:1}),o(r,{style:{"text-align":"right"}},{default:l(()=>[o(E,{"html-type":"submit",type:"primary"},{default:l(()=>[F("发表文章")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],64)}}});export{yt as default};
